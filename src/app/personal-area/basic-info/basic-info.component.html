<div class="wrapper" *ngIf='infoForm'>
    <h2>Основная информация</h2>
    <form [formGroup]="infoForm">
        <ng-container *ngIf='card.services'>
            <app-service-categories [srv]='card.services'></app-service-categories>
        </ng-container>        

        <div class="container" formArrayName="departureAreas">
            <h3>Районы выезда</h3>        
            <p class="description" *ngIf="!array('departureAreas').length; else fieldIs">Вы не указали районы выезда. Добавьте районы выезда, чтобы заказчикам было легче Вас найти и Вы смогли получать больше заказов из разных частей города.</p>
        
            <ng-template #fieldIs>
                <p class="description">Добавьте районы выезда, чтобы заказчикам было легче Вас найти и Вы смогли получать больше заказов из разных частей города.</p>
            </ng-template>

            <ng-container *ngFor="let departureArea of array('departureAreas'), let i = index">
                <div class="block" [formGroupName]="i">
                    <p class="title">{{ i + 1 }}.</p>
                    <p class="title-mobile">Район выезда {{ i + 1 }}</p>
            
                    <fieldset>
                        <legend>Населенный пункт</legend>
                        <input type="text" formControlName="locality">
                    </fieldset>
            
                    <fieldset>
                        <legend>Район</legend>
                        <input type="text" formControlName="district">
                    </fieldset>
            
                    <mat-icon class='delete' (click)="deleteElement(array('departureAreas'), i)">delete</mat-icon>
                </div>
            </ng-container>

            <button class="add"
                    (click)="addDepartureArea()"
                    [ngStyle]="{marginTop: array('departureAreas').length === 0 ? '18px' : ''}">
                    <mat-icon>add</mat-icon>Добавить район выезда
            </button>       
        </div>

        <div class="container" formArrayName="metro">
            <h3>Метро</h3>        
            <p class="description" *ngIf="!array('metro').length; else fieldIs">Вы не указали станции метро. Добавьте станции метро, чтобы заказчикам было легче Вас найти и Вы смогли получать больше заказов из разных частей города.</p>
        
            <ng-template #fieldIs>
                <p class="description">Добавьте станции метро, чтобы заказчикам было легче Вас найти и Вы смогли получать больше заказов из разных частей города.</p>
            </ng-template>
            
            <div class="block" *ngFor="let oneMetro of array('metro'), let i = index">
                <p class="title">{{ i + 1 }}.</p>
                <p class="title-mobile">Район выезда {{ i + 1 }}</p>        
                <fieldset *ngIf="metro$ | async as metro">
                    <legend>Станция метро</legend>
                    <select type="text" formControlName="{{i}}">
                        <option>Не выбрано</option>
                        <ng-container *ngFor='let station of metro.stations'>
                            <option [value]="station.title">{{station.title}}</option>
                        </ng-container>
                    </select>
                </fieldset>            
                <mat-icon class='delete' (click)="deleteElement(array('metro'), i)">delete</mat-icon>
            </div>
        
            <button class="add"
                    (click)="addMetro()"
                    [ngClass]="array('metro').length ? '' : 'empty'">
                    <mat-icon>add</mat-icon>Добавить метро
            </button>        
        </div>

        <div class="container" formArrayName="contactPerson">
            <h3>Контактное лицо</h3>        
            <p class="description" *ngIf="!array('contactPerson').length; else fieldIs">Вы не добавили контактное лицо. Добавьте контактное лицо, чтобы заказчики могли оставлять заявки конкретному человеку.</p>
        
            <ng-template #fieldIs>
                <p class="description">Добавьте контактное лицо, чтобы заказчики могли оставлять заявки конкретному человеку.</p>
            </ng-template>
        
            <ng-container *ngFor="let person of array('contactPerson'), let i = index">
                <div class="contact-face" [formGroupName]="i">
                    <p>Контактное лицо {{ i + 1 }}</p>
                    <div class="fieldsets">
                        <fieldset>
                            <legend>Фамилия</legend>
                            <input type="text" formControlName="lastName">
                        </fieldset>
            
                        <fieldset>
                            <legend>Имя</legend>
                            <input type="text" formControlName="firstName">
                        </fieldset>
            
                        <fieldset>
                            <legend>Телефон</legend>
                            <input type="text" formControlName="tel">
                        </fieldset>
            
                        <fieldset>
                            <legend>E-mail</legend>
                            <input type="text" formControlName="email">
                        </fieldset>
                    </div>            
                    <label>
                        <input type="checkbox" (click)="switchActive('contactPerson', i)" [checked]='person.active' formControlName="active">
                        <p>Использовать в качестве основного контактного лица</p>
                    </label>            
                    <mat-icon class='delete' (click)="deleteElement(array('contactPerson'), i)">delete</mat-icon>
                </div>
            </ng-container>        
            <button class="add"
                    (click)="addContactPerson()"
                    [ngClass]="array('metro').length ? '' : 'empty'">
                    <mat-icon>add</mat-icon>Добавить контактное лицо
            </button>        
        </div>

        <div class="container">
            <h3>Местоположение</h3>        
            <p class="description">Добавьте местоположение, чтобы заказчики могли посещать Ваш офис.</p>
            <div class="fieldsets" formGroupName="location">
                <div class="house-and-apartment">
                    <fieldset>
                        <legend>Населенный пункт</legend>
                        <input type="text" placeholder="Введите название" formControlName="locality">
                    </fieldset>        
                    <div class="mini-fieldsets">
                        <fieldset>
                            <legend>Дом</legend>
                            <input type="text" placeholder="Введите номер" formControlName="house">
                        </fieldset>            
                        <fieldset>
                            <legend>Литера</legend>
                            <input type="text" placeholder="Введите номер" formControlName="typographicLiterature">
                        </fieldset>
                    </div>
                </div>
        
                <div class="house-and-apartment">
                    <fieldset>
                        <legend>Улица</legend>
                        <input type="text" placeholder="Введите название" formControlName="street">
                    </fieldset>        
                    <div class="mini-fieldsets">
                        <fieldset>
                            <legend>Корпус</legend>
                            <input type="text" placeholder="Введите номер" formControlName="housing">
                        </fieldset>
                        <fieldset>
                            <legend>Офис/квартира</legend>
                            <input type="text" placeholder="Введите номер" formControlName="apartment">
                        </fieldset>
                    </div>
                </div>
            </div>        
        </div>

        <div class="container" formArrayName="type">
            <h3>Тип исполнителя</h3>        
            <p class="description" *ngIf="!array('type').length; else fieldIs">Вы не выбрали тип исполнителя. Выберите тип исполнителя, чтобы пользователи понимали с кем они будут работать.</p>
        
            <ng-template #fieldIs>
                <p class="description">Выберите тип исполнителя, чтобы пользователи понимали с кем они будут работать.</p>
            </ng-template>
        
            <ng-container *ngFor="let type of array('type'), let i = index">
                <div class="performer-type" [formGroupName]="i">
                    <p>Исполнитель {{ i + 1 }}</p>            
                    <div class="fieldsets">
                        <fieldset>
                            <legend>Тип исполнителя</legend>
                            <select formControlName="title">
                                <option>Не выбран</option>
                                <option value="юридическое лицо">Юридическое лицо</option>
                                <option value="индивидуальный предприниматель">Индивидуальный предприниматель</option>
                            </select>
                        </fieldset>
            
                        <fieldset>
                            <legend>Реквизиты</legend>
                            <select formControlName="requisites">
                                <option>Не выбран</option>
                                <option value="ООО “Строитель-исполнитель”">ООО “Строитель-исполнитель”</option>
                                <option value="ИП Иванов">ИП Иванов</option>
                            </select>
                        </fieldset>
                    </div>            
                    <label>
                        <input type="checkbox" (click)="switchActive('type', i)" [checked]='type.active' formControlName="active">
                        <p>Использовать в качестве основного исполнителя</p>
                    </label>            
                    <mat-icon class='delete' (click)="deleteElement(array('type'), i)">delete</mat-icon>
                </div>
            </ng-container>        
            <button class="add"
                    (click)="addPerformerType()"
                    [ngClass]="array('metro').length ? '' : 'empty'">
                    <mat-icon>add</mat-icon>Добавить тип исполнителя
            </button>        
        </div>
        <button class="save" 
                [disabled]='infoForm.invalid'
                (click)="submitInfo()">Сохранить изменения</button>
    </form>
</div>